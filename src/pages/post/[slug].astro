---
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import MathJaxHead from '../../components/MathJaxHead.astro';
import RandomOneOf from '../../components/RandomOneOf.astro';

export async function getStaticPaths() {
	const posts = await getCollection('posts');
	return posts.map(post => ({
		params: { slug: post.slug },
		props: post,
	}));
}
type Props = CollectionEntry<'posts'>;

const post = Astro.props;
const { title, description, date, tags } = post.data;
const { Content, headings } = await post.render();
---

<!doctype html>
<html lang='en'>
	<head>
		<BaseHead title={title} description={description} />
		<MathJaxHead />
	</head>
	<body>
		<div class='mx-auto mb-auto grid w-[calc(100%-1em)] max-w-6xl grid-cols-11 max-md:grid-cols-5'>
			<div class='col-span-6 col-start-3 my-2 flex flex-col items-start font-body max-md:col-start-1'>
				<span class='flex items-center'>
					<a class='text-slate-500 hover:text-slate-600' href='/'>Posts</a><svg
						xmlns='http://www.w3.org/2000/svg'
						width='16'
						height='16'
						fill='currentColor'
						class='bi bi-slash'
						viewBox='0 0 16 16'
					>
						<path d='M11.354 4.646a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708l6-6a.5.5 0 0 1 .708 0z'></path>
					</svg>
				</span>
				<time class='text-lg' datetime={date.toISOString()}>
					{date.toLocaleDateString('en-us', { year: 'numeric', month: 'short', day: 'numeric' })}
				</time>
				<h1 class='font-heading text-4xl font-bold'>{title}</h1>
				<ul class='flex flex-wrap gap-1'>
					{
						tags.map(tag => (
							<a href={`/tagged/${tag}/`}>
								<li class='h-fit rounded-full border border-gray-300 bg-slate-100 px-1 text-base font-light text-gray-600'>{tag}</li>
							</a>
						))
					}
				</ul>
				<hr class='mb-4 mt-2 self-stretch' />
			</div>
			<main
				class='prose col-span-6 col-start-3 prose-a:font-normal prose-a:underline prose-a:after:inline-block prose-a:after:w-[15px] prose-a:after:align-middle prose-a:after:content-[url(/external-link.svg)] max-md:col-start-1'
			>
				<Content components={{ RandomOneOf }} />
			</main>
			<aside class='sticky top-0 col-span-2 ml-4 mt-2 h-fit scroll-smooth pt-2 max-md:hidden'>
				<h1>Table of Content</h1>
				<ul>
					{
						headings.map(h => (
							<li>
								<a href={`#${h.slug}`}>{h.text}</a>
							</li>
						))
					}
				</ul>
			</aside>
		</div>
		<Footer />
	</body>
</html>
